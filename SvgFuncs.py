#<?xml version="1.0" encoding="UTF-8" standalone="no"?>
#<svg width="210mm" height="297mm" viewBox="0 0 210 297" version="1.1" id="svg8">
#<path id="gridhline0001" d="M 40,70 H 65" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridhline0002" d="M 40,75 H 65" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridhline0003" d="M 40,80 H 65" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridhline0004" d="M 40,85 H 65" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridhline0005" d="M 40,90 H 65" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridhline0006" d="M 40,95 H 65" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridvline0001" d="M 65,70 V 95" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridvline0002" d="M 60,70 V 95" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridvline0003" d="M 55,70 V 95" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridvline0004" d="M 50,70 V 95" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridvline0005" d="M 45,70 V 95" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="gridvline0006" d="M 40,70 V 95" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4552" d="M 22,70 H 37" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4554" d="M 22,75 H 37" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4556" d="M 22,80 H 37" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4558" d="M 22,85 H 37" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4560" d="M 22,90 H 37" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4562" d="M 22,95 H 37" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4564" d="M 37,70 V 95" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4566" d="M 32,70 V 95" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4568" d="M 27,70 V 95" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4570" d="M 22,70 V 95" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4588" d="M 40,52 V 67" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4590" d="M 45,52 V 67" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4592" d="M 50,52 V 67" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4594" d="M 55,52 V 67" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4596" d="M 60,52 V 67" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4598" d="M 65,52 V 67" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4600" d="M 40,67 H 65" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4602" d="M 40,62 H 65" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4604" d="M 40,57 H 65" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#<path id="path4606" d="M 40,52 H 65" style="fill:none;stroke:#000000;stroke-width:0.2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
#</svg>
#

def XmlHeader():
	return '<?xml version="1.0" encoding="UTF-8" standalone="no"?>'
	
def SvgA4Header():
	return '<svg width="210mm" height="297mm" viewBox="0 0 210 297" version="1.1" id="svg8">'
	
def SvgBlackVerticalLine(id_name, start_x, start_y, end_y, width):
	return '<path id="{}" d="M {},{} V {}" style="fill:none;stroke:#000000;stroke-width:{};stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />'.format(id_name, start_x, start_y, end_y, width)
	
def SvgBlackHorizontalLine(id_name, start_x, start_y, end_x, width):
	return '<path id="{}" d="M {},{} H {}" style="fill:none;stroke:#000000;stroke-width:{};stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />'.format(id_name, start_x, start_y, end_x, width)

def SvgGrid(origin_x, origin_y, nx, ny, spacing_px, grid_id_stem, horizontal_major_inc, vertical_major_inc):
	path_lines = []
	for i in range(nx + 1):
		line_width = 0.2
		if ((horizontal_major_inc > 0) and (i % horizontal_major_inc == 0)) or (i == 0) or (i == nx):
			line_width = 0.4
		path_lines.append(SvgBlackVerticalLine('{}vline{:04d}'.format(grid_id_stem, i), origin_x + i * spacing_px, origin_y, origin_y + ny * spacing_px, line_width))
	for i in range(ny + 1):
		line_width = 0.2
		if ((vertical_major_inc > 0) and (i % vertical_major_inc == 0)) or (i == 0) or (i == ny):
			line_width = 0.4
		path_lines.append(SvgBlackHorizontalLine('{}hline{:04d}'.format(grid_id_stem, i), origin_x, origin_y + i * spacing_px, origin_x + nx * spacing_px, line_width))
		
	return '\n'.join(path_lines)

def SvgRect(id_name, origin_x, origin_y, width, height, hex_colour):
	return '<rect id="{}" x="{}" y="{}" width="{}" height="{}" style="opacity:1;fill:{};fill-opacity:1;stroke:none;stroke-width:0;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:normal" />'.format(id_name, origin_x, origin_y, width, height, hex_colour)
		
	
def SvgPixelGrid(origin_x, origin_y, pixel_size, grid_id_stem, pixel_array):
	rect_lines = []
	px_ind = 0
	for i in range(pixel_array.shape[0]):
		for j in range(pixel_array.shape[1]):
			rect_lines.append(SvgRect('{}pxrect{:06d}'.format(grid_id_stem, px_ind), origin_x + j * pixel_size, origin_y + i * pixel_size, pixel_size, pixel_size, Rgb2Hex(pixel_array[i,j,0], pixel_array[i,j,1], pixel_array[i,j,2])))
			px_ind += 1
			
	return '\n'.join(rect_lines)
	
def SvgText(id_name, origin_x, origin_y, font_size, hex_colour, text):
	return '<text id="{}" x="{}" y="{}" xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:{}px;line-height:1;font-family:monospace;font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-feature-settings:normal;text-align:center;letter-spacing:0px;word-spacing:0px;writing-mode:lr-tb;dominant-baseline:central;text-anchor:middle;fill:{};fill-opacity:1;stroke:none;stroke-width:0">{}</text>'.format(id_name, origin_x, origin_y, font_size, hex_colour, text)
	
	
def SvgTextPixelGrid(origin_x, origin_y, pixel_size, grid_id_stem, text_array, pixel_array):
	text_lines = []
	px_ind = 0
	for i in range(pixel_array.shape[0]):
		for j in range(pixel_array.shape[1]):
			if text_array[i][j] is not None:
				text_colour = '#000000'
				
				if (pixel_array[i,j,0]*0.299 + pixel_array[i,j,1]*0.587 + pixel_array[i,j,2]*0.114) < 0.5:
					text_colour = '#ffffff'
				
				text_lines.append(SvgText('{}pxtext{:06d}'.format(grid_id_stem, px_ind), origin_x + j * pixel_size + pixel_size / 2.0, origin_y + i * pixel_size + pixel_size / 1.7, 0.7 * pixel_size, text_colour, text_array[i][j]))
			px_ind += 1
			
	return '\n'.join(text_lines)
	
def Rgb2Hex(red_float, green_float, blue_float):
	return '#{:02x}{:02x}{:02x}'.format(int(round(255*red_float)), int(round(255*green_float)), int(round(255*blue_float))).upper()
	
def Hex2Rgb(hex_colour):
	return (int(str(hex_colour[1:3]), 16) / 255.0, int(str(hex_colour[3:5]), 16) / 255.0, int(str(hex_colour[5:7]), 16) / 255.0)
	
	
if __name__ == '__main__':
	horizontal_max = 4
	vertical_max = 4
	nx = 23
	ny = 23
	spacing = 5
	
	with open('SvgPy.svg', 'w') as fp:
		fp.write(XmlHeader())
		fp.write('\n')
		fp.write(SvgA4Header())
		fp.write('\n')
		fp.write(SvgGrid((horizontal_max + 1) * spacing, 0, nx, vertical_max, spacing, 'vclues', 5, 0))
		fp.write('\n')
		fp.write(SvgGrid(0,(vertical_max + 1) * spacing, horizontal_max, ny, spacing, 'hclues', 0, 5))
		fp.write('\n')
		fp.write(SvgGrid((horizontal_max + 1) * spacing, (vertical_max + 1) * spacing, nx, ny, spacing, 'grid', 5, 5))
		fp.write('\n')
		fp.write('</svg>')